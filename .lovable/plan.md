
# План реализации

## Обзор изменений

Реализуем 4 функции:

1. Фотографии в отзывах
2. Видео из Shopify галереи вместо блока "A Simple Peace of Mind"
3. Поддержка видео в галерее товаров
4. Подсказка о размерах только для товаров с соответствующим медиа в Shopify

---

## 1. Фотографии в отзывах

### Что делаем:
- Добавляем storage bucket для фото отзывов
- Расширяем таблицу reviews, добавляя массив URL фотографий
- Обновляем форму отзыва - добавляем кнопку загрузки фото (до 3 шт)
- Отображаем фото в карточках отзывов с лайтбоксом

### Изменения:
- **База данных**: миграция для добавления колонки `photo_urls text[]`
- **Storage**: создание bucket `review-photos` с публичным доступом
- **StaticReviewsSection.tsx**: добавляем поле загрузки и отображение фото
- **useProductReviews.ts**: обновляем типы и мутацию

---

## 2. Видео вместо блока "A Simple Peace of Mind"

### Что делаем:
- Удаляем блок `ProblemSolutionSection` со страницы товара
- Ищем в Shopify галерее медиа с altText содержащим "video"
- Если найдено - показываем видео-плеер
- Если нет - ничего не показываем (без заглушки)

### Логика определения:
```text
Если altText изображения содержит "video" → отображаем как видео
```

### Изменения:
- **ProductPage.tsx**: 
  - Удаляем `<ProblemSolutionSection />`
  - Добавляем поиск видео по altText
  - Рендерим видео-секцию на месте старого блока

---

## 3. Поддержка видео в галерее

### Что делаем:
- В карусели галереи (altText = "gallery") поддерживаем MP4/WebM
- Если URL заканчивается на `.mp4` или `.webm` → рендерим `<video>` вместо `<img>`
- Видео автовоспроизводится без звука в цикле

### Изменения:
- **ProductPage.tsx**: в секции галереи проверяем расширение файла

---

## 4. Подсказка о размерах по данным из Shopify

### Что делаем:
- Вместо статической ссылки на size-chart.jpg проверяем галерею Shopify
- Если есть изображение с altText содержащим "sizechart" → показываем ссылку
- Это изображение открывается в лайтбоксе
- Если такого изображения нет → подсказка не отображается

### Логика:
```text
Если в галерее есть медиа с altText.includes("sizechart") → показать ссылку "Please measure..."
При клике → открыть это изображение в лайтбоксе
```

### Изменения:
- **ProductPage.tsx**: 
  - Ищем `sizechartMedia` среди images
  - Условно рендерим кнопку подсказки
  - Обновляем лайтбокс для показа изображения из Shopify

---

## Визуальная схема изменений ProductPage

```text
┌─────────────────────────────────────────┐
│  Hero Image                             │
├─────────────────────────────────────────┤
│  Title + Price + Limited stock badge    │
├─────────────────────────────────────────┤
│  Variant Options                        │
├─────────────────────────────────────────┤
│  Upsell Section                         │
├─────────────────────────────────────────┤
│  Add to Cart Button                     │
├─────────────────────────────────────────┤
│  "Ready to ship"                        │
├─────────────────────────────────────────┤
│  Size Chart Link  ← УСЛОВНО (sizechart) │
├─────────────────────────────────────────┤
│  Description Accordion                  │
├─────────────────────────────────────────┤
│  ❌ ProblemSolutionSection (УДАЛЁН)     │
├─────────────────────────────────────────┤
│  Video Section ← НОВЫЙ (если есть video)│
├─────────────────────────────────────────┤
│  GIF/Demo Section (если есть gif)       │
├─────────────────────────────────────────┤
│  Mid-page CTA                           │
├─────────────────────────────────────────┤
│  Gallery Carousel (поддержка видео)     │
├─────────────────────────────────────────┤
│  Reviews Section (с фото)               │
└─────────────────────────────────────────┘
```

---

## Технические детали

### База данных (миграция)

```sql
-- Добавляем колонку для URL фотографий
ALTER TABLE reviews ADD COLUMN photo_urls text[] DEFAULT '{}';

-- Создаём bucket для фото отзывов
INSERT INTO storage.buckets (id, name, public)
VALUES ('review-photos', 'review-photos', true);

-- RLS политики для storage
CREATE POLICY "Anyone can upload review photos"
ON storage.objects FOR INSERT
WITH CHECK (bucket_id = 'review-photos');

CREATE POLICY "Anyone can view review photos"  
ON storage.objects FOR SELECT
USING (bucket_id = 'review-photos');
```

### Типы Shopify altText

| altText содержит | Назначение |
|-----------------|-----------|
| `gallery` | Показать в карусели галереи |
| `gif` | Показать в блоке GIF/Demo |
| `video` | Показать в новой видео-секции |
| `sizechart` | Показать подсказку о размерах |

---

## Файлы для изменения

1. **supabase/migrations/xxx.sql** - миграция БД + storage
2. **src/pages/ProductPage.tsx** - основные изменения логики
3. **src/components/product/StaticReviewsSection.tsx** - загрузка и отображение фото
4. **src/hooks/useProductReviews.ts** - обновление типов
5. **src/components/product/ProductVideoSection.tsx** - новый компонент для видео

---

## Как добавлять контент в Shopify

После реализации, чтобы настроить товар:

1. **Видео на странице товара**: загрузить видео/изображение с altText = "video"
2. **Подсказка о размерах**: загрузить изображение с altText = "sizechart"
3. **GIF/Demo**: загрузить с altText = "gif" (уже работает)
4. **Галерея**: загрузить с altText = "gallery" (уже работает)
